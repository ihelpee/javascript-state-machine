StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:"*",create:function(e,f){var h=(typeof e.initial=="string")?{state:e.initial}:e.initial;var d=f||e.target||{};var j=e.events||[];var g=e.callbacks||{};var b={};var i=function(k){var m=(k.from instanceof Array)?k.from:(k.from?[k.from]:[StateMachine.WILDCARD]);b[k.name]=b[k.name]||{};for(var l=0;l<m.length;l++){b[k.name][m[l]]=k.to||m[l]}};if(h){h.event=h.event||"startup";i({name:h.event,from:"none",to:h.state})}for(var c=0;c<j.length;c++){i(j[c])}for(var a in b){if(b.hasOwnProperty(a)){d[a]=StateMachine.buildEvent(a,b[a])}}for(var a in g){if(g.hasOwnProperty(a)){d[a]=g[a]}}d.current="none";d.is=function(k){return this.current==k};d.can=function(k){return !this.transition&&(b[k].hasOwnProperty(this.current)||b[k].hasOwnProperty(StateMachine.WILDCARD))};d.cannot=function(k){return !this.can(k)};d.error=e.error||function(m,p,o,l,k,n){throw n};if(h&&!h.defer){d[h.event]()}return d},doCallback:function(f,c,b,h,g,a){if(c){try{return c.apply(f,[b,h,g].concat(a))}catch(d){return f.error(b,h,g,a,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function")}}},beforeEvent:function(c,b,e,d,a){return StateMachine.doCallback(c,c["onbefore"+b],b,e,d,a)},afterEvent:function(c,b,e,d,a){return StateMachine.doCallback(c,c["onafter"+b]||c["on"+b],b,e,d,a)},leaveState:function(c,b,e,d,a){return StateMachine.doCallback(c,c["onleave"+e],b,e,d,a)},enterState:function(c,b,e,d,a){return StateMachine.doCallback(c,c["onenter"+d]||c["on"+d],b,e,d,a)},changeState:function(c,b,e,d,a){return StateMachine.doCallback(c,c.onchangestate,b,e,d,a)},buildEvent:function(a,b){return function(){var f=this.current;var e=b[f]||b[StateMachine.WILDCARD]||f;var c=Array.prototype.slice.call(arguments);if(this.transition){return this.error(a,f,e,c,StateMachine.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete")}if(this.cannot(a)){return this.error(a,f,e,c,StateMachine.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current)}if(false===StateMachine.beforeEvent(this,a,f,e,c)){return StateMachine.CANCELLED}if(f!==e){var d=this;this.transition=function(){d.transition=null;d.current=e;StateMachine.enterState(d,a,f,e,c);StateMachine.changeState(d,a,f,e,c);StateMachine.afterEvent(d,a,f,e,c);return StateMachine.SUCCEEDED};if(false!==StateMachine.leaveState(this,a,f,e,c)){if(this.transition){return this.transition()}}return StateMachine.ASYNC}StateMachine.afterEvent(this,a,f,e,c);return StateMachine.SUCCEEDED}}};
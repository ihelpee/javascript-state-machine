StateMachine={create:function(f,b,c){var e={startup:["none"]};var g,d,a;for(g=0;g<c.length;g++){d=c[g];a=d.name;e[a]=(e[a]||[]).concat(d.from);f[a]=this.buildEvent(a,d.from,d.to,f)}f.current="none";f.is=function(h){return this.current==h};f.can=function(h){return e[h].indexOf(this.current)>=0};f.cannot=function(h){return !this.can(h)};this.buildEvent("startup","none",b,f).call(f);return f},buildEvent:function(a,d,c,b){return function(){if(this.cannot(a)){throw"event "+a+" innapropriate in current state "+this.current}var e=this["onbefore"+a];if(e&&(false===e.apply(this,arguments))){return}var f=this["onleave"+this.current];if(f){f.apply(this,arguments)}this.current=c;var g=this["onenter"+c]||this["on"+c];if(g){g.apply(this,arguments)}var h=this["onafter"+a]||this["on"+a];if(h){h.apply(this,arguments)}}}};
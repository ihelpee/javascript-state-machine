StateMachine={create:function(a){var g=a.target||{};var d=a.events;var h,f,c,e={};for(h=0;h<d.length;h++){f=d[h];c=f.name;e[c]=(e[c]||[]).concat(f.from);g[c]=this.buildEvent(c,f.from,f.to,g)}g.current="none";g.is=function(i){return this.current==i};g.can=function(i){return e[i].indexOf(this.current)>=0};g.cannot=function(i){return !this.can(i)};if(a.initial){var b=(typeof a.initial=="string")?{state:a.initial}:a.initial;c=b.event||"startup";e[c]=["none"];f=this.buildEvent(c,"none",b.state,g);if(b.defer){g[c]=f}else{f.call(g)}}return g},buildEvent:function(a,d,c,b){return function(){if(this.cannot(a)){throw"event "+a+" innapropriate in current state "+this.current}var e=this["onbefore"+a];if(e&&(false===e.apply(this,arguments))){return}if(this.current!=c){var f=this["onleave"+this.current];if(f){f.apply(this,arguments)}this.current=c;var g=this["onenter"+c]||this["on"+c];if(g){g.apply(this,arguments)}}var h=this["onafter"+a]||this["on"+a];if(h){h.apply(this,arguments)}}}};
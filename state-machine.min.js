StateMachine={create:function(a){var g=a.target||{};var c=a.state;var d=a.events;var f={startup:["none"]};var h,e,b;for(h=0;h<d.length;h++){e=d[h];b=e.name;f[b]=(f[b]||[]).concat(e.from);g[b]=this.buildEvent(b,e.from,e.to,g)}g.current="none";g.is=function(i){return this.current==i};g.can=function(i){return f[i].indexOf(this.current)>=0};g.cannot=function(i){return !this.can(i)};this.buildEvent("startup","none",c,g).call(g);return g},buildEvent:function(a,d,c,b){return function(){if(this.cannot(a)){throw"event "+a+" innapropriate in current state "+this.current}var e=this["onbefore"+a];if(e&&(false===e.apply(this,arguments))){return}var f=this["onleave"+this.current];if(f){f.apply(this,arguments)}this.current=c;var g=this["onenter"+c]||this["on"+c];if(g){g.apply(this,arguments)}var h=this["onafter"+a]||this["on"+a];if(h){h.apply(this,arguments)}}}};